<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªá th·ªëng Qu·∫£n l√Ω Trung t√¢m Th·ªÉ d·ª•c</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header h1 {
        font-size: 28px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-badge {
        background: rgba(255, 255, 255, 0.2);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
      }

      .btn-logout {
        background: #ff6b6b;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
      }

      .btn-logout:hover {
        background: #ff5252;
        transform: translateY(-2px);
      }

      .login-container {
        padding: 60px;
        text-align: center;
      }

      .login-box {
        max-width: 400px;
        margin: 0 auto;
        background: #f8f9fa;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .login-box h2 {
        color: #667eea;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 20px;
        text-align: left;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #555;
        font-weight: 600;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: border 0.3s;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s;
        width: 100%;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      .main-content {
        display: flex;
        min-height: 600px;
      }

      .sidebar {
        width: 260px;
        background: #2c3e50;
        color: white;
        padding: 0;
      }

      .menu-item {
        padding: 18px 25px;
        cursor: pointer;
        transition: all 0.3s;
        border-left: 4px solid transparent;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .menu-item:hover {
        background: rgba(255, 255, 255, 0.1);
        border-left-color: #667eea;
      }

      .menu-item.active {
        background: rgba(102, 126, 234, 0.3);
        border-left-color: #667eea;
      }

      .content-area {
        flex: 1;
        padding: 30px;
        background: #f8f9fa;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .stat-card h3 {
        color: #666;
        font-size: 14px;
        margin-bottom: 10px;
        text-transform: uppercase;
      }

      .stat-card .number {
        font-size: 32px;
        font-weight: bold;
        color: #667eea;
      }

      .stat-card.revenue .number {
        color: #28a745;
      }

      .stat-card.warning .number {
        color: #ffa502;
      }

      .stat-card.danger .number {
        color: #ff6b6b;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .section-header h2 {
        color: #2c3e50;
        font-size: 24px;
      }

      .btn-add {
        background: #28a745;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
      }

      .btn-add:hover {
        background: #218838;
        transform: translateY(-2px);
      }

      .table-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      th {
        padding: 15px;
        text-align: left;
        font-weight: 600;
      }

      td {
        padding: 15px;
        border-bottom: 1px solid #e0e0e0;
      }

      tbody tr:hover {
        background: #f8f9fa;
      }

      .badge {
        display: inline-block;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .badge.active {
        background: #d4edda;
        color: #155724;
      }

      .badge.expired {
        background: #f8d7da;
        color: #721c24;
      }

      .badge.expiring {
        background: #fff3cd;
        color: #856404;
      }

      .actions {
        display: flex;
        gap: 8px;
      }

      .btn-icon {
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 5px;
        transition: all 0.3s;
      }

      .btn-icon:hover {
        background: #e0e0e0;
      }

      .btn-edit {
        color: #007bff;
      }

      .btn-delete {
        color: #dc3545;
      }

      .btn-qr {
        color: #28a745;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal.show {
        display: flex;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-header h3 {
        color: #2c3e50;
        font-size: 22px;
      }

      .btn-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #999;
      }

      .btn-close:hover {
        color: #333;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
      }

      .btn-secondary:hover {
        background: #5a6268;
      }

      .qr-code-display {
        text-align: center;
        padding: 20px;
      }

      .qr-code-display canvas {
        margin: 20px auto;
        border: 4px solid #667eea;
        border-radius: 10px;
      }

      .schedule-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }

      .schedule-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #667eea;
      }

      .schedule-card h4 {
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .schedule-info {
        color: #666;
        margin: 5px 0;
        font-size: 14px;
      }

      .filter-bar {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }

      .filter-bar input,
      .filter-bar select {
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        flex: 1;
        min-width: 200px;
      }

      .checkin-scanner {
        text-align: center;
        padding: 40px;
      }

      .checkin-input {
        font-size: 24px;
        padding: 20px;
        border: 3px solid #667eea;
        border-radius: 12px;
        text-align: center;
        width: 100%;
        max-width: 400px;
      }

      .alert {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .alert-danger {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .invoice-preview {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .invoice-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #667eea;
      }

      .invoice-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .invoice-items {
        margin: 20px 0;
      }

      .invoice-total {
        text-align: right;
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 2px solid #e0e0e0;
      }

      @media print {
        body * {
          visibility: hidden;
        }
        .invoice-preview,
        .invoice-preview * {
          visibility: visible;
        }
        .invoice-preview {
          position: absolute;
          left: 0;
          top: 0;
        }
      }

      .member-card-preview {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        width: 400px;
        margin: 20px auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .member-card-preview h3 {
        margin-bottom: 20px;
        font-size: 14px;
        opacity: 0.9;
      }

      .member-card-preview .name {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .member-card-preview .details {
        margin: 5px 0;
        opacity: 0.95;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
      }

      .empty-state img {
        width: 200px;
        opacity: 0.5;
        margin-bottom: 20px;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid #e0e0e0;
      }

      .tab {
        padding: 12px 24px;
        cursor: pointer;
        border: none;
        background: none;
        color: #666;
        font-weight: 600;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
      }

      .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
      }

      .tab:hover {
        color: #667eea;
      }
    </style>
  </head>
  <body>
    <div class="container" id="app">
      <!-- Login Screen -->
      <div id="loginScreen" style="display: none">
        <div class="login-container">
          <div class="login-box">
            <h2>üèãÔ∏è ƒêƒÉng nh·∫≠p H·ªá th·ªëng</h2>
            <form id="loginForm">
              <div class="form-group">
                <label>T√™n ƒëƒÉng nh·∫≠p</label>
                <input type="text" id="loginUsername" required />
              </div>
              <div class="form-group">
                <label>M·∫≠t kh·∫©u</label>
                <input type="password" id="loginPassword" required />
              </div>
              <div class="form-group">
                <label>Vai tr√≤</label>
                <select id="loginRole" required>
                  <option value="admin">Qu·∫£n tr·ªã vi√™n</option>
                  <option value="trainer">Hu·∫•n luy·ªán vi√™n</option>
                  <option value="member">H·ªôi vi√™n</option>
                </select>
              </div>
              <button type="submit" class="btn-primary">ƒêƒÉng nh·∫≠p</button>
            </form>
            <p style="margin-top: 20px; color: #666; font-size: 12px">
              Demo: admin/admin, trainer/trainer, member/member
            </p>
          </div>
        </div>
      </div>

      <!-- Main Application -->
      <div id="mainApp" style="display: none">
        <div class="header">
          <h1>üèãÔ∏è H·ªá th·ªëng Qu·∫£n l√Ω Gym</h1>
          <div class="user-info">
            <div class="user-badge" id="currentUserBadge"></div>
            <button class="btn-logout" onclick="logout()">ƒêƒÉng xu·∫•t</button>
          </div>
        </div>

        <div class="main-content">
          <div class="sidebar" id="sidebar"></div>
          <div class="content-area" id="contentArea"></div>
        </div>
      </div>
    </div>

    <!-- Modals -->
    <div id="memberModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="memberModalTitle">Th√™m h·ªôi vi√™n m·ªõi</h3>
          <button class="btn-close" onclick="closeModal('memberModal')">
            &times;
          </button>
        </div>
        <form id="memberForm">
          <input type="hidden" id="memberId" />
          <div class="form-row">
            <div class="form-group">
              <label>H·ªç v√† t√™n *</label>
              <input type="text" id="memberName" required />
            </div>
            <div class="form-group">
              <label>S·ªë ƒëi·ªán tho·∫°i *</label>
              <input type="tel" id="memberPhone" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Email</label>
              <input type="email" id="memberEmail" />
            </div>
            <div class="form-group">
              <label>Ng√†y sinh</label>
              <input type="date" id="memberDob" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Gi·ªõi t√≠nh</label>
              <select id="memberGender">
                <option value="male">Nam</option>
                <option value="female">N·ªØ</option>
                <option value="other">Kh√°c</option>
              </select>
            </div>
            <div class="form-group">
              <label>G√≥i d·ªãch v·ª• *</label>
              <select id="memberPackage" required>
                <option value="1month">1 Th√°ng - 500,000ƒë</option>
                <option value="3months">3 Th√°ng - 1,350,000ƒë</option>
                <option value="6months">6 Th√°ng - 2,500,000ƒë</option>
                <option value="1year">1 NƒÉm - 4,500,000ƒë</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>ƒê·ªãa ch·ªâ</label>
            <textarea id="memberAddress" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label>Ghi ch√∫</label>
            <textarea id="memberNotes" rows="2"></textarea>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn-secondary"
              onclick="closeModal('memberModal')"
            >
              H·ªßy
            </button>
            <button type="submit" class="btn-primary">L∆∞u</button>
          </div>
        </form>
      </div>
    </div>

    <div id="scheduleModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ƒê·∫∑t l·ªãch t·∫≠p</h3>
          <button class="btn-close" onclick="closeModal('scheduleModal')">
            &times;
          </button>
        </div>
        <form id="scheduleForm">
          <input type="hidden" id="scheduleId" />
          <div class="form-group">
            <label>H·ªôi vi√™n *</label>
            <select id="scheduleMember" required></select>
          </div>
          <div class="form-group">
            <label>Hu·∫•n luy·ªán vi√™n *</label>
            <select id="scheduleTrainer" required></select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Ng√†y t·∫≠p *</label>
              <input type="date" id="scheduleDate" required />
            </div>
            <div class="form-group">
              <label>Th·ªùi gian *</label>
              <input type="time" id="scheduleTime" required />
            </div>
          </div>
          <div class="form-group">
            <label>Ph√≤ng/Khu v·ª±c</label>
            <select id="scheduleFacility">
              <option value="room1">Ph√≤ng t·∫≠p 1</option>
              <option value="room2">Ph√≤ng t·∫≠p 2</option>
              <option value="cardio">Khu Cardio</option>
              <option value="weights">Khu T·∫° t·ª± do</option>
              <option value="yoga">Ph√≤ng Yoga</option>
            </select>
          </div>
          <div class="form-group">
            <label>Ghi ch√∫</label>
            <textarea id="scheduleNotes" rows="3"></textarea>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn-secondary"
              onclick="closeModal('scheduleModal')"
            >
              H·ªßy
            </button>
            <button type="submit" class="btn-primary">ƒê·∫∑t l·ªãch</button>
          </div>
        </form>
      </div>
    </div>

    <div id="qrModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>M√£ QR Check-in</h3>
          <button class="btn-close" onclick="closeModal('qrModal')">
            &times;
          </button>
        </div>
        <div class="qr-code-display">
          <div class="member-card-preview" id="qrMemberCard"></div>
          <canvas id="qrCanvas"></canvas>
          <p style="margin-top: 20px; color: #666">
            Qu√©t m√£ QR n√†y ƒë·ªÉ check-in t·∫°i trung t√¢m
          </p>
          <button class="btn-primary" onclick="window.print()">In th·∫ª</button>
        </div>
      </div>
    </div>

    <div id="invoiceModal" class="modal">
      <div class="modal-content" style="max-width: 800px">
        <div class="modal-header">
          <h3>H√≥a ƒë∆°n thanh to√°n</h3>
          <button class="btn-close" onclick="closeModal('invoiceModal')">
            &times;
          </button>
        </div>
        <div class="invoice-preview" id="invoicePreview"></div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn-secondary"
            onclick="closeModal('invoiceModal')"
          >
            ƒê√≥ng
          </button>
          <button type="button" class="btn-primary" onclick="window.print()">
            In h√≥a ƒë∆°n
          </button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script>
      // Global State
      let currentUser = null;
      let currentView = "dashboard";

      // Initialize Sample Data
      function initializeData() {
        if (!localStorage.getItem("gym_members")) {
          const sampleMembers = [
            {
              id: "MEM001",
              name: "Nguy·ªÖn VƒÉn A",
              phone: "0901234567",
              email: "vana@email.com",
              dob: "1990-05-15",
              gender: "male",
              address: "123 ƒê∆∞·ªùng ABC, Q1, TP.HCM",
              package: "3months",
              startDate: "2024-09-01",
              endDate: "2024-12-01",
              status: "active",
              registeredDate: "2024-09-01",
              notes: "",
            },
            {
              id: "MEM002",
              name: "Tr·∫ßn Th·ªã B",
              phone: "0907654321",
              email: "thib@email.com",
              dob: "1995-08-20",
              gender: "female",
              address: "456 ƒê∆∞·ªùng XYZ, Q2, TP.HCM",
              package: "1year",
              startDate: "2024-01-15",
              endDate: "2025-01-15",
              status: "active",
              registeredDate: "2024-01-15",
              notes: "",
            },
            {
              id: "MEM003",
              name: "L√™ VƒÉn C",
              phone: "0909876543",
              email: "vanc@email.com",
              dob: "1988-03-10",
              gender: "male",
              address: "789 ƒê∆∞·ªùng DEF, Q3, TP.HCM",
              package: "1month",
              startDate: "2024-10-25",
              endDate: "2024-11-25",
              status: "expiring",
              registeredDate: "2024-10-25",
              notes: "",
            },
          ];
          localStorage.setItem("gym_members", JSON.stringify(sampleMembers));

          const sampleTrainers = [
            {
              id: "TR001",
              name: "PT Minh Tu·∫•n",
              phone: "0911111111",
              email: "minhtuan@gym.com",
              specialty: "Bodybuilding, Fitness",
              experience: "5 nƒÉm",
              certifications: "ACE-CPT, NASM",
            },
            {
              id: "TR002",
              name: "PT Lan Anh",
              phone: "0922222222",
              email: "lananh@gym.com",
              specialty: "Yoga, Pilates",
              experience: "3 nƒÉm",
              certifications: "RYT-200",
            },
          ];
          localStorage.setItem("gym_trainers", JSON.stringify(sampleTrainers));

          const sampleSchedules = [
            {
              id: "SCH001",
              memberId: "MEM001",
              trainerId: "TR001",
              date: "2024-11-22",
              time: "08:00",
              facility: "room1",
              status: "scheduled",
              notes: "Bu·ªïi t·∫≠p ƒë·∫ßu ti√™n",
            },
          ];
          localStorage.setItem(
            "gym_schedules",
            JSON.stringify(sampleSchedules)
          );

          const sampleCheckins = [
            {
              id: "CHK001",
              memberId: "MEM001",
              date: "2024-11-21",
              time: "07:30",
              facility: "cardio",
            },
          ];
          localStorage.setItem("gym_checkins", JSON.stringify(sampleCheckins));

          const sampleInvoices = [
            {
              id: "INV001",
              memberId: "MEM001",
              amount: 1350000,
              package: "3months",
              date: "2024-09-01",
              status: "paid",
              paymentMethod: "cash",
            },
          ];
          localStorage.setItem("gym_invoices", JSON.stringify(sampleInvoices));
        }
      }

      // Authentication
      function showLogin() {
        document.getElementById("loginScreen").style.display = "block";
        document.getElementById("mainApp").style.display = "none";
      }

      function showMainApp() {
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("mainApp").style.display = "block";
        renderSidebar();
        renderContent();
      }

      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const username = document.getElementById("loginUsername").value;
          const password = document.getElementById("loginPassword").value;
          const role = document.getElementById("loginRole").value;

          // Simple authentication
          if (
            password === username ||
            (username === "admin" && password === "admin")
          ) {
            currentUser = {
              username: username,
              role: role,
              name:
                role === "admin"
                  ? "Qu·∫£n tr·ªã vi√™n"
                  : role === "trainer"
                  ? "PT " + username
                  : "H·ªôi vi√™n " + username,
            };
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
            document.getElementById("currentUserBadge").textContent =
              currentUser.name + " (" + getRoleName(role) + ")";
            showMainApp();
          } else {
            alert("Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!");
          }
        });

      function logout() {
        currentUser = null;
        localStorage.removeItem("currentUser");
        showLogin();
      }

      function getRoleName(role) {
        const roles = {
          admin: "Admin",
          trainer: "Hu·∫•n luy·ªán vi√™n",
          member: "H·ªôi vi√™n",
        };
        return roles[role] || role;
      }

      // Sidebar Menu
      function renderSidebar() {
        const sidebar = document.getElementById("sidebar");
        const menus = {
          admin: [
            { id: "dashboard", icon: "üìä", label: "T·ªïng quan" },
            { id: "members", icon: "üë•", label: "Qu·∫£n l√Ω h·ªôi vi√™n" },
            { id: "memberships", icon: "üí≥", label: "G√≥i d·ªãch v·ª•" },
            { id: "trainers", icon: "üèãÔ∏è", label: "Hu·∫•n luy·ªán vi√™n" },
            { id: "schedules", icon: "üìÖ", label: "L·ªãch t·∫≠p" },
            { id: "checkins", icon: "‚úÖ", label: "Check-in" },
            { id: "facilities", icon: "üè¢", label: "Ph√≤ng/Thi·∫øt b·ªã" },
            { id: "invoices", icon: "üí∞", label: "Thu chi" },
            { id: "reports", icon: "üìà", label: "B√°o c√°o" },
          ],
          trainer: [
            { id: "dashboard", icon: "üìä", label: "T·ªïng quan" },
            { id: "schedules", icon: "üìÖ", label: "L·ªãch c·ªßa t√¥i" },
            { id: "members", icon: "üë•", label: "H·ªçc vi√™n" },
            { id: "checkins", icon: "‚úÖ", label: "Check-in" },
          ],
          member: [
            { id: "dashboard", icon: "üìä", label: "Trang ch·ªß" },
            { id: "mySchedules", icon: "üìÖ", label: "L·ªãch t·∫≠p c·ªßa t√¥i" },
            { id: "myMembership", icon: "üí≥", label: "Th·∫ª c·ªßa t√¥i" },
            { id: "myCheckins", icon: "‚úÖ", label: "L·ªãch s·ª≠ t·∫≠p" },
            { id: "myInvoices", icon: "üí∞", label: "H√≥a ƒë∆°n" },
          ],
        };

        const userMenus = menus[currentUser.role] || menus.member;
        sidebar.innerHTML = userMenus
          .map(
            (menu) => `
                <div class="menu-item ${
                  menu.id === currentView ? "active" : ""
                }" onclick="navigateTo('${menu.id}')">
                    <span style="font-size: 20px;">${menu.icon}</span>
                    <span>${menu.label}</span>
                </div>
            `
          )
          .join("");
      }

      function navigateTo(view) {
        currentView = view;
        renderSidebar();
        renderContent();
      }

      // Content Rendering
      function renderContent() {
        const contentArea = document.getElementById("contentArea");

        switch (currentView) {
          case "dashboard":
            renderDashboard();
            break;
          case "members":
            renderMembers();
            break;
          case "memberships":
            renderMemberships();
            break;
          case "trainers":
            renderTrainers();
            break;
          case "schedules":
            renderSchedules();
            break;
          case "checkins":
            renderCheckins();
            break;
          case "facilities":
            renderFacilities();
            break;
          case "invoices":
            renderInvoices();
            break;
          case "reports":
            renderReports();
            break;
          case "mySchedules":
            renderMySchedules();
            break;
          case "myMembership":
            renderMyMembership();
            break;
          case "myCheckins":
            renderMyCheckins();
            break;
          case "myInvoices":
            renderMyInvoices();
            break;
          default:
            renderDashboard();
        }
      }

      // Dashboard
      function renderDashboard() {
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const checkins = JSON.parse(
          localStorage.getItem("gym_checkins") || "[]"
        );
        const invoices = JSON.parse(
          localStorage.getItem("gym_invoices") || "[]"
        );

        const activeMembers = members.filter(
          (m) => m.status === "active"
        ).length;
        const expiringMembers = members.filter(
          (m) => m.status === "expiring"
        ).length;
        const todayCheckins = checkins.filter(
          (c) => c.date === new Date().toISOString().split("T")[0]
        ).length;
        const monthRevenue = invoices
          .filter((i) => i.date.startsWith("2024-11"))
          .reduce((sum, i) => sum + i.amount, 0);

        const contentArea = document.getElementById("contentArea");
        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>üìä T·ªïng quan h·ªá th·ªëng</h2>
                </div>
                
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>H·ªôi vi√™n ho·∫°t ƒë·ªông</h3>
                        <div class="number">${activeMembers}</div>
                    </div>
                    <div class="stat-card warning">
                        <h3>S·∫Øp h·∫øt h·∫°n</h3>
                        <div class="number">${expiringMembers}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Check-in h√¥m nay</h3>
                        <div class="number">${todayCheckins}</div>
                    </div>
                    <div class="stat-card revenue">
                        <h3>Doanh thu th√°ng n√†y</h3>
                        <div class="number">${formatCurrency(
                          monthRevenue
                        )}</div>
                    </div>
                </div>

                ${
                  expiringMembers > 0
                    ? `
                <div class="alert alert-warning">
                    ‚ö†Ô∏è C√≥ ${expiringMembers} h·ªôi vi√™n s·∫Øp h·∫øt h·∫°n th·∫ª. H√£y li√™n h·ªá ƒë·ªÉ gia h·∫°n!
                </div>
                `
                    : ""
                }

                <div class="section-header">
                    <h3>üìÖ L·ªãch t·∫≠p h√¥m nay</h3>
                </div>
                ${renderTodaySchedules()}

                <div class="section-header" style="margin-top: 30px;">
                    <h3>üìã Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h3>
                </div>
                ${renderRecentActivity()}
            `;
      }

      function renderTodaySchedules() {
        const schedules = JSON.parse(
          localStorage.getItem("gym_schedules") || "[]"
        );
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const trainers = JSON.parse(
          localStorage.getItem("gym_trainers") || "[]"
        );
        const today = new Date().toISOString().split("T")[0];

        const todaySchedules = schedules.filter((s) => s.date === today);

        if (todaySchedules.length === 0) {
          return '<div class="empty-state">Kh√¥ng c√≥ l·ªãch t·∫≠p n√†o h√¥m nay</div>';
        }

        return `
                <div class="schedule-grid">
                    ${todaySchedules
                      .map((schedule) => {
                        const member = members.find(
                          (m) => m.id === schedule.memberId
                        );
                        const trainer = trainers.find(
                          (t) => t.id === schedule.trainerId
                        );
                        return `
                            <div class="schedule-card">
                                <h4>‚è∞ ${schedule.time}</h4>
                                <div class="schedule-info">üë§ H·ªôi vi√™n: ${
                                  member?.name || "N/A"
                                }</div>
                                <div class="schedule-info">üèãÔ∏è PT: ${
                                  trainer?.name || "N/A"
                                }</div>
                                <div class="schedule-info">üè¢ ${getFacilityName(
                                  schedule.facility
                                )}</div>
                                ${
                                  schedule.notes
                                    ? `<div class="schedule-info">üìù ${schedule.notes}</div>`
                                    : ""
                                }
                            </div>
                        `;
                      })
                      .join("")}
                </div>
            `;
      }

      function renderRecentActivity() {
        const checkins = JSON.parse(
          localStorage.getItem("gym_checkins") || "[]"
        );
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");

        const recentCheckins = checkins.slice(-10).reverse();

        if (recentCheckins.length === 0) {
          return '<div class="empty-state">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</div>';
        }

        return `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Th·ªùi gian</th>
                                <th>H·ªôi vi√™n</th>
                                <th>Khu v·ª±c</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recentCheckins
                              .map((checkin) => {
                                const member = members.find(
                                  (m) => m.id === checkin.memberId
                                );
                                return `
                                    <tr>
                                        <td>${checkin.date} ${checkin.time}</td>
                                        <td>${member?.name || "N/A"}</td>
                                        <td>${getFacilityName(
                                          checkin.facility
                                        )}</td>
                                    </tr>
                                `;
                              })
                              .join("")}
                        </tbody>
                    </table>
                </div>
            `;
      }

      // Members Management
      function renderMembers() {
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const contentArea = document.getElementById("contentArea");

        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>üë• Qu·∫£n l√Ω h·ªôi vi√™n</h2>
                    ${
                      currentUser.role === "admin"
                        ? '<button class="btn-add" onclick="openMemberModal()">+ Th√™m h·ªôi vi√™n</button>'
                        : ""
                    }
                </div>

                <div class="filter-bar">
                    <input type="text" id="searchMember" placeholder="üîç T√¨m theo t√™n, SƒêT, email..." oninput="filterMembers()">
                    <select id="filterStatus" onchange="filterMembers()">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                        <option value="expiring">S·∫Øp h·∫øt h·∫°n</option>
                        <option value="expired">H·∫øt h·∫°n</option>
                    </select>
                </div>

                <div class="table-container" id="membersTable">
                    ${renderMembersTable(members)}
                </div>
            `;
      }

      function renderMembersTable(members) {
        if (members.length === 0) {
          return '<div class="empty-state">Ch∆∞a c√≥ h·ªôi vi√™n n√†o</div>';
        }

        return `
                <table>
                    <thead>
                        <tr>
                            <th>M√£ HV</th>
                            <th>H·ªç t√™n</th>
                            <th>SƒêT</th>
                            <th>G√≥i d·ªãch v·ª•</th>
                            <th>Ng√†y h·∫øt h·∫°n</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${members
                          .map(
                            (member) => `
                            <tr>
                                <td><strong>${member.id}</strong></td>
                                <td>${member.name}</td>
                                <td>${member.phone}</td>
                                <td>${getPackageName(member.package)}</td>
                                <td>${formatDate(member.endDate)}</td>
                                <td><span class="badge ${
                                  member.status
                                }">${getStatusName(member.status)}</span></td>
                                <td>
                                    <div class="actions">
                                        <button class="btn-icon btn-qr" onclick="showQRCode('${
                                          member.id
                                        }')" title="M√£ QR">üì±</button>
                                        ${
                                          currentUser.role === "admin"
                                            ? `
                                            <button class="btn-icon btn-edit" onclick="editMember('${member.id}')" title="S·ª≠a">‚úèÔ∏è</button>
                                            <button class="btn-icon btn-delete" onclick="deleteMember('${member.id}')" title="X√≥a">üóëÔ∏è</button>
                                        `
                                            : ""
                                        }
                                    </div>
                                </td>
                            </tr>
                        `
                          )
                          .join("")}
                    </tbody>
                </table>
            `;
      }

      function filterMembers() {
        const searchText = document
          .getElementById("searchMember")
          .value.toLowerCase();
        const statusFilter = document.getElementById("filterStatus").value;
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");

        let filtered = members.filter((member) => {
          const matchSearch =
            member.name.toLowerCase().includes(searchText) ||
            member.phone.includes(searchText) ||
            member.email.toLowerCase().includes(searchText);
          const matchStatus = !statusFilter || member.status === statusFilter;
          return matchSearch && matchStatus;
        });

        document.getElementById("membersTable").innerHTML =
          renderMembersTable(filtered);
      }

      function openMemberModal(memberId = null) {
        const modal = document.getElementById("memberModal");
        const form = document.getElementById("memberForm");
        form.reset();

        if (memberId) {
          const members = JSON.parse(
            localStorage.getItem("gym_members") || "[]"
          );
          const member = members.find((m) => m.id === memberId);
          if (member) {
            document.getElementById("memberModalTitle").textContent =
              "Ch·ªânh s·ª≠a h·ªôi vi√™n";
            document.getElementById("memberId").value = member.id;
            document.getElementById("memberName").value = member.name;
            document.getElementById("memberPhone").value = member.phone;
            document.getElementById("memberEmail").value = member.email || "";
            document.getElementById("memberDob").value = member.dob || "";
            document.getElementById("memberGender").value = member.gender;
            document.getElementById("memberPackage").value = member.package;
            document.getElementById("memberAddress").value =
              member.address || "";
            document.getElementById("memberNotes").value = member.notes || "";
          }
        } else {
          document.getElementById("memberModalTitle").textContent =
            "Th√™m h·ªôi vi√™n m·ªõi";
        }

        modal.classList.add("show");
      }

      function editMember(memberId) {
        openMemberModal(memberId);
      }

      function deleteMember(memberId) {
        if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªôi vi√™n n√†y?")) {
          let members = JSON.parse(localStorage.getItem("gym_members") || "[]");
          members = members.filter((m) => m.id !== memberId);
          localStorage.setItem("gym_members", JSON.stringify(members));
          renderMembers();
        }
      }

      document
        .getElementById("memberForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const memberId = document.getElementById("memberId").value;
          const packageType = document.getElementById("memberPackage").value;
          const startDate = new Date();
          const endDate = calculateEndDate(startDate, packageType);

          const memberData = {
            id: memberId || "MEM" + String(Date.now()).slice(-6),
            name: document.getElementById("memberName").value,
            phone: document.getElementById("memberPhone").value,
            email: document.getElementById("memberEmail").value,
            dob: document.getElementById("memberDob").value,
            gender: document.getElementById("memberGender").value,
            address: document.getElementById("memberAddress").value,
            package: packageType,
            startDate: startDate.toISOString().split("T")[0],
            endDate: endDate.toISOString().split("T")[0],
            status: "active",
            registeredDate: memberId
              ? undefined
              : startDate.toISOString().split("T")[0],
            notes: document.getElementById("memberNotes").value,
          };

          let members = JSON.parse(localStorage.getItem("gym_members") || "[]");

          if (memberId) {
            const index = members.findIndex((m) => m.id === memberId);
            if (index !== -1) {
              members[index] = { ...members[index], ...memberData };
            }
          } else {
            members.push(memberData);

            // Create invoice
            const invoice = {
              id: "INV" + String(Date.now()).slice(-6),
              memberId: memberData.id,
              amount: getPackagePrice(packageType),
              package: packageType,
              date: startDate.toISOString().split("T")[0],
              status: "paid",
              paymentMethod: "cash",
            };
            let invoices = JSON.parse(
              localStorage.getItem("gym_invoices") || "[]"
            );
            invoices.push(invoice);
            localStorage.setItem("gym_invoices", JSON.stringify(invoices));
          }

          localStorage.setItem("gym_members", JSON.stringify(members));
          closeModal("memberModal");
          renderMembers();

          if (!memberId) {
            alert(
              "‚úÖ ƒêƒÉng k√Ω h·ªôi vi√™n th√†nh c√¥ng!\nM√£ h·ªôi vi√™n: " + memberData.id
            );
          }
        });

      function calculateEndDate(startDate, packageType) {
        const date = new Date(startDate);
        switch (packageType) {
          case "1month":
            date.setMonth(date.getMonth() + 1);
            break;
          case "3months":
            date.setMonth(date.getMonth() + 3);
            break;
          case "6months":
            date.setMonth(date.getMonth() + 6);
            break;
          case "1year":
            date.setFullYear(date.getFullYear() + 1);
            break;
        }
        return date;
      }

      // Schedules
      function renderSchedules() {
        const schedules = JSON.parse(
          localStorage.getItem("gym_schedules") || "[]"
        );
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const trainers = JSON.parse(
          localStorage.getItem("gym_trainers") || "[]"
        );
        const contentArea = document.getElementById("contentArea");

        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>üìÖ Qu·∫£n l√Ω l·ªãch t·∫≠p</h2>
                    <button class="btn-add" onclick="openScheduleModal()">+ ƒê·∫∑t l·ªãch m·ªõi</button>
                </div>

                <div class="filter-bar">
                    <input type="date" id="filterDate" onchange="filterSchedules()">
                    <select id="filterTrainer" onchange="filterSchedules()">
                        <option value="">T·∫•t c·∫£ PT</option>
                        ${trainers
                          .map(
                            (t) => `<option value="${t.id}">${t.name}</option>`
                          )
                          .join("")}
                    </select>
                </div>

                <div id="schedulesContainer">
                    ${renderSchedulesGrid(schedules, members, trainers)}
                </div>
            `;
      }

      function renderSchedulesGrid(schedules, members, trainers) {
        if (schedules.length === 0) {
          return '<div class="empty-state">Ch∆∞a c√≥ l·ªãch t·∫≠p n√†o</div>';
        }

        return `
                <div class="schedule-grid">
                    ${schedules
                      .map((schedule) => {
                        const member = members.find(
                          (m) => m.id === schedule.memberId
                        );
                        const trainer = trainers.find(
                          (t) => t.id === schedule.trainerId
                        );
                        return `
                            <div class="schedule-card">
                                <h4>üìÖ ${formatDate(schedule.date)}</h4>
                                <div class="schedule-info">‚è∞ ${
                                  schedule.time
                                }</div>
                                <div class="schedule-info">üë§ HV: ${
                                  member?.name || "N/A"
                                }</div>
                                <div class="schedule-info">üèãÔ∏è PT: ${
                                  trainer?.name || "N/A"
                                }</div>
                                <div class="schedule-info">üè¢ ${getFacilityName(
                                  schedule.facility
                                )}</div>
                                ${
                                  schedule.notes
                                    ? `<div class="schedule-info">üìù ${schedule.notes}</div>`
                                    : ""
                                }
                                ${
                                  currentUser.role === "admin"
                                    ? `
                                    <div class="actions" style="margin-top: 10px;">
                                        <button class="btn-icon btn-edit" onclick="editSchedule('${schedule.id}')">‚úèÔ∏è S·ª≠a</button>
                                        <button class="btn-icon btn-delete" onclick="deleteSchedule('${schedule.id}')">üóëÔ∏è X√≥a</button>
                                    </div>
                                `
                                    : ""
                                }
                            </div>
                        `;
                      })
                      .join("")}
                </div>
            `;
      }

      function openScheduleModal(scheduleId = null) {
        const modal = document.getElementById("scheduleModal");
        const form = document.getElementById("scheduleForm");
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const trainers = JSON.parse(
          localStorage.getItem("gym_trainers") || "[]"
        );

        // Populate member dropdown
        const memberSelect = document.getElementById("scheduleMember");
        memberSelect.innerHTML = members
          .map((m) => `<option value="${m.id}">${m.name} (${m.id})</option>`)
          .join("");

        // Populate trainer dropdown
        const trainerSelect = document.getElementById("scheduleTrainer");
        trainerSelect.innerHTML = trainers
          .map((t) => `<option value="${t.id}">${t.name}</option>`)
          .join("");

        form.reset();

        if (scheduleId) {
          const schedules = JSON.parse(
            localStorage.getItem("gym_schedules") || "[]"
          );
          const schedule = schedules.find((s) => s.id === scheduleId);
          if (schedule) {
            document.getElementById("scheduleId").value = schedule.id;
            document.getElementById("scheduleMember").value = schedule.memberId;
            document.getElementById("scheduleTrainer").value =
              schedule.trainerId;
            document.getElementById("scheduleDate").value = schedule.date;
            document.getElementById("scheduleTime").value = schedule.time;
            document.getElementById("scheduleFacility").value =
              schedule.facility;
            document.getElementById("scheduleNotes").value =
              schedule.notes || "";
          }
        }

        modal.classList.add("show");
      }

      function editSchedule(scheduleId) {
        openScheduleModal(scheduleId);
      }

      function deleteSchedule(scheduleId) {
        if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l·ªãch t·∫≠p n√†y?")) {
          let schedules = JSON.parse(
            localStorage.getItem("gym_schedules") || "[]"
          );
          schedules = schedules.filter((s) => s.id !== scheduleId);
          localStorage.setItem("gym_schedules", JSON.stringify(schedules));
          renderSchedules();
        }
      }

      document
        .getElementById("scheduleForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const scheduleId = document.getElementById("scheduleId").value;
          const scheduleData = {
            id: scheduleId || "SCH" + String(Date.now()).slice(-6),
            memberId: document.getElementById("scheduleMember").value,
            trainerId: document.getElementById("scheduleTrainer").value,
            date: document.getElementById("scheduleDate").value,
            time: document.getElementById("scheduleTime").value,
            facility: document.getElementById("scheduleFacility").value,
            status: "scheduled",
            notes: document.getElementById("scheduleNotes").value,
          };

          let schedules = JSON.parse(
            localStorage.getItem("gym_schedules") || "[]"
          );

          if (scheduleId) {
            const index = schedules.findIndex((s) => s.id === scheduleId);
            if (index !== -1) {
              schedules[index] = scheduleData;
            }
          } else {
            schedules.push(scheduleData);
          }

          localStorage.setItem("gym_schedules", JSON.stringify(schedules));
          closeModal("scheduleModal");
          renderSchedules();
          alert("‚úÖ ƒê·∫∑t l·ªãch th√†nh c√¥ng!");
        });

      // Check-in
      function renderCheckins() {
        const contentArea = document.getElementById("contentArea");
        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>‚úÖ Qu·∫£n l√Ω Check-in</h2>
                </div>

                <div class="checkin-scanner">
                    <h3 style="margin-bottom: 20px;">Nh·∫≠p m√£ h·ªôi vi√™n ho·∫∑c qu√©t QR</h3>
                    <input type="text" 
                           class="checkin-input" 
                           id="checkinInput" 
                           placeholder="MEM001"
                           autofocus>
                    <button class="btn-primary" onclick="processCheckin()" style="margin-top: 20px; max-width: 400px;">
                        Check-in
                    </button>
                </div>

                <div class="section-header" style="margin-top: 40px;">
                    <h3>L·ªãch s·ª≠ check-in h√¥m nay</h3>
                </div>
                ${renderTodayCheckins()}
            `;

        document
          .getElementById("checkinInput")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              processCheckin();
            }
          });
      }

      function processCheckin() {
        const memberId = document
          .getElementById("checkinInput")
          .value.trim()
          .toUpperCase();
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const member = members.find((m) => m.id === memberId);

        if (!member) {
          alert("‚ùå Kh√¥ng t√¨m th·∫•y h·ªôi vi√™n v·ªõi m√£: " + memberId);
          return;
        }

        if (member.status === "expired") {
          alert("‚ö†Ô∏è Th·∫ª h·ªôi vi√™n ƒë√£ h·∫øt h·∫°n! Vui l√≤ng gia h·∫°n.");
          return;
        }

        const checkin = {
          id: "CHK" + String(Date.now()).slice(-6),
          memberId: memberId,
          date: new Date().toISOString().split("T")[0],
          time: new Date().toLocaleTimeString("vi-VN", {
            hour: "2-digit",
            minute: "2-digit",
          }),
          facility: "main",
        };

        let checkins = JSON.parse(localStorage.getItem("gym_checkins") || "[]");
        checkins.push(checkin);
        localStorage.setItem("gym_checkins", JSON.stringify(checkins));

        alert(
          `‚úÖ Check-in th√†nh c√¥ng!\n\nH·ªôi vi√™n: ${member.name}\nTh·ªùi gian: ${checkin.time}`
        );
        document.getElementById("checkinInput").value = "";
        renderCheckins();
      }

      function renderTodayCheckins() {
        const checkins = JSON.parse(
          localStorage.getItem("gym_checkins") || "[]"
        );
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const today = new Date().toISOString().split("T")[0];
        const todayCheckins = checkins.filter((c) => c.date === today);

        if (todayCheckins.length === 0) {
          return '<div class="empty-state">Ch∆∞a c√≥ check-in n√†o h√¥m nay</div>';
        }

        return `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Th·ªùi gian</th>
                                <th>M√£ HV</th>
                                <th>H·ªç t√™n</th>
                                <th>Khu v·ª±c</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${todayCheckins
                              .reverse()
                              .map((checkin) => {
                                const member = members.find(
                                  (m) => m.id === checkin.memberId
                                );
                                return `
                                    <tr>
                                        <td><strong>${
                                          checkin.time
                                        }</strong></td>
                                        <td>${checkin.memberId}</td>
                                        <td>${member?.name || "N/A"}</td>
                                        <td>${getFacilityName(
                                          checkin.facility
                                        )}</td>
                                    </tr>
                                `;
                              })
                              .join("")}
                        </tbody>
                    </table>
                </div>
            `;
      }

      // QR Code
      function showQRCode(memberId) {
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const member = members.find((m) => m.id === memberId);

        if (!member) return;

        const qrData = JSON.stringify({
          id: member.id,
          name: member.name,
          expiry: member.endDate,
        });

        document.getElementById("qrMemberCard").innerHTML = `
                <h3>TRUNG T√ÇM TH·ªÇ D·ª§C FITNESS</h3>
                <div class="name">${member.name}</div>
                <div class="details">M√£ HV: ${member.id}</div>
                <div class="details">G√≥i: ${getPackageName(
                  member.package
                )}</div>
                <div class="details">H·∫°n: ${formatDate(member.endDate)}</div>
            `;

        const canvas = document.getElementById("qrCanvas");
        QRCode.toCanvas(canvas, qrData, {
          width: 300,
          margin: 2,
          color: {
            dark: "#000000",
            light: "#FFFFFF",
          },
        });

        document.getElementById("qrModal").classList.add("show");
      }

      // Invoices
      function renderInvoices() {
        const invoices = JSON.parse(
          localStorage.getItem("gym_invoices") || "[]"
        );
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const contentArea = document.getElementById("contentArea");

        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>üí∞ Qu·∫£n l√Ω thu chi</h2>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>M√£ Hƒê</th>
                                <th>Ng√†y</th>
                                <th>H·ªôi vi√™n</th>
                                <th>G√≥i d·ªãch v·ª•</th>
                                <th>S·ªë ti·ªÅn</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${invoices
                              .reverse()
                              .map((invoice) => {
                                const member = members.find(
                                  (m) => m.id === invoice.memberId
                                );
                                return `
                                    <tr>
                                        <td><strong>${invoice.id}</strong></td>
                                        <td>${formatDate(invoice.date)}</td>
                                        <td>${member?.name || "N/A"}</td>
                                        <td>${getPackageName(
                                          invoice.package
                                        )}</td>
                                        <td><strong>${formatCurrency(
                                          invoice.amount
                                        )}</strong></td>
                                        <td><span class="badge ${
                                          invoice.status === "paid"
                                            ? "active"
                                            : "expired"
                                        }">${
                                  invoice.status === "paid"
                                    ? "ƒê√£ thanh to√°n"
                                    : "Ch∆∞a thanh to√°n"
                                }</span></td>
                                        <td>
                                            <button class="btn-icon" onclick="viewInvoice('${
                                              invoice.id
                                            }')" title="Xem">üëÅÔ∏è</button>
                                        </td>
                                    </tr>
                                `;
                              })
                              .join("")}
                        </tbody>
                    </table>
                </div>
            `;
      }

      function viewInvoice(invoiceId) {
        const invoices = JSON.parse(
          localStorage.getItem("gym_invoices") || "[]"
        );
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const invoice = invoices.find((i) => i.id === invoiceId);
        const member = members.find((m) => m.id === invoice.memberId);

        if (!invoice) return;

        document.getElementById("invoicePreview").innerHTML = `
                <div class="invoice-header">
                    <h2>üèãÔ∏è TRUNG T√ÇM TH·ªÇ D·ª§C FITNESS</h2>
                    <p>123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM</p>
                    <p>Hotline: 0900 123 456</p>
                </div>
                <h3 style="text-align: center; color: #667eea; margin-bottom: 20px;">H√ìA ƒê∆†N THANH TO√ÅN</h3>
                <div class="invoice-details">
                    <div>
                        <p><strong>M√£ h√≥a ƒë∆°n:</strong> ${invoice.id}</p>
                        <p><strong>Ng√†y:</strong> ${formatDate(
                          invoice.date
                        )}</p>
                        <p><strong>Ph∆∞∆°ng th·ª©c:</strong> ${
                          invoice.paymentMethod === "cash"
                            ? "Ti·ªÅn m·∫∑t"
                            : "Chuy·ªÉn kho·∫£n"
                        }</p>
                    </div>
                    <div>
                        <p><strong>Kh√°ch h√†ng:</strong> ${
                          member?.name || "N/A"
                        }</p>
                        <p><strong>M√£ HV:</strong> ${invoice.memberId}</p>
                        <p><strong>SƒêT:</strong> ${member?.phone || "N/A"}</p>
                    </div>
                </div>
                <div class="invoice-items">
                    <table style="width: 100%;">
                        <thead style="background: #f8f9fa; color: #333;">
                            <tr>
                                <th style="text-align: left;">D·ªãch v·ª•</th>
                                <th style="text-align: right;">S·ªë ti·ªÅn</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>G√≥i t·∫≠p: ${getPackageName(
                                  invoice.package
                                )}</td>
                                <td style="text-align: right;">${formatCurrency(
                                  invoice.amount
                                )}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="invoice-total">
                    T·ªïng c·ªông: ${formatCurrency(invoice.amount)}
                </div>
                <p style="text-align: center; margin-top: 30px; color: #666;">
                    C·∫£m ∆°n qu√Ω kh√°ch! Ch√∫c qu√Ω kh√°ch t·∫≠p luy·ªán hi·ªáu qu·∫£!
                </p>
            `;

        document.getElementById("invoiceModal").classList.add("show");
      }

      // Reports
      function renderReports() {
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        const invoices = JSON.parse(
          localStorage.getItem("gym_invoices") || "[]"
        );
        const checkins = JSON.parse(
          localStorage.getItem("gym_checkins") || "[]"
        );

        const totalMembers = members.length;
        const activeMembers = members.filter(
          (m) => m.status === "active"
        ).length;
        const totalRevenue = invoices.reduce((sum, i) => sum + i.amount, 0);
        const monthRevenue = invoices
          .filter((i) =>
            i.date.startsWith(new Date().toISOString().slice(0, 7))
          )
          .reduce((sum, i) => sum + i.amount, 0);

        const contentArea = document.getElementById("contentArea");
        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>üìà B√°o c√°o & Th·ªëng k√™</h2>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="switchReportTab('overview')">T·ªïng quan</button>
                    <button class="tab" onclick="switchReportTab('revenue')">Doanh thu</button>
                    <button class="tab" onclick="switchReportTab('members')">H·ªôi vi√™n</button>
                </div>

                <div id="reportContent">
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <h3>T·ªïng s·ªë h·ªôi vi√™n</h3>
                            <div class="number">${totalMembers}</div>
                        </div>
                        <div class="stat-card">
                            <h3>H·ªôi vi√™n ho·∫°t ƒë·ªông</h3>
                            <div class="number">${activeMembers}</div>
                        </div>
                        <div class="stat-card revenue">
                            <h3>Doanh thu th√°ng n√†y</h3>
                            <div class="number">${formatCurrency(
                              monthRevenue
                            )}</div>
                        </div>
                        <div class="stat-card revenue">
                            <h3>T·ªïng doanh thu</h3>
                            <div class="number">${formatCurrency(
                              totalRevenue
                            )}</div>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3>üìä Th·ªëng k√™ g√≥i d·ªãch v·ª•</h3>
                        ${renderPackageStats(members)}
                    </div>

                    <div style="margin-top: 30px;">
                        <h3>üìÖ Check-in theo th√°ng</h3>
                        ${renderCheckinStats(checkins)}
                    </div>
                </div>
            `;
      }

      function renderPackageStats(members) {
        const packageStats = members.reduce((acc, member) => {
          acc[member.package] = (acc[member.package] || 0) + 1;
          return acc;
        }, {});

        return `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>G√≥i d·ªãch v·ª•</th>
                                <th>S·ªë l∆∞·ª£ng</th>
                                <th>T·ª∑ l·ªá</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(packageStats)
                              .map(
                                ([pkg, count]) => `
                                <tr>
                                    <td>${getPackageName(pkg)}</td>
                                    <td><strong>${count}</strong></td>
                                    <td>${(
                                      (count / members.length) *
                                      100
                                    ).toFixed(1)}%</td>
                                </tr>
                            `
                              )
                              .join("")}
                        </tbody>
                    </table>
                </div>
            `;
      }

      function renderCheckinStats(checkins) {
        const today = new Date();
        const last7Days = [];
        for (let i = 6; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          last7Days.push(date.toISOString().split("T")[0]);
        }

        return `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ng√†y</th>
                                <th>S·ªë l∆∞·ª£t check-in</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${last7Days
                              .map((date) => {
                                const count = checkins.filter(
                                  (c) => c.date === date
                                ).length;
                                return `
                                    <tr>
                                        <td>${formatDate(date)}</td>
                                        <td><strong>${count}</strong></td>
                                    </tr>
                                `;
                              })
                              .join("")}
                        </tbody>
                    </table>
                </div>
            `;
      }

      // Other views
      function renderMemberships() {
        const contentArea = document.getElementById("contentArea");
        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>üí≥ G√≥i d·ªãch v·ª•</h2>
                </div>

                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>G√≥i 1 Th√°ng</h3>
                        <div class="number">500,000ƒë</div>
                        <p style="color: #666; margin-top: 10px;">Ph√π h·ª£p ƒë·ªÉ tr·∫£i nghi·ªám</p>
                    </div>
                    <div class="stat-card">
                        <h3>G√≥i 3 Th√°ng</h3>
                        <div class="number">1,350,000ƒë</div>
                        <p style="color: #666; margin-top: 10px;">Ti·∫øt ki·ªám 10%</p>
                    </div>
                    <div class="stat-card">
                        <h3>G√≥i 6 Th√°ng</h3>
                        <div class="number">2,500,000ƒë</div>
                        <p style="color: #666; margin-top: 10px;">Ti·∫øt ki·ªám 17%</p>
                    </div>
                    <div class="stat-card">
                        <h3>G√≥i 1 NƒÉm</h3>
                        <div class="number">4,500,000ƒë</div>
                        <p style="color: #666; margin-top: 10px;">Ti·∫øt ki·ªám 25%</p>
                    </div>
                </div>

                <div style="margin-top: 30px; background: white; padding: 30px; border-radius: 12px;">
                    <h3 style="margin-bottom: 20px;">Quy·ªÅn l·ª£i h·ªôi vi√™n</h3>
                    <ul style="line-height: 2; color: #666;">
                        <li>‚úÖ S·ª≠ d·ª•ng to√†n b·ªô thi·∫øt b·ªã t·∫≠p luy·ªán hi·ªán ƒë·∫°i</li>
                        <li>‚úÖ Tham gia c√°c l·ªõp t·∫≠p Yoga, Aerobic, Zumba</li>
                        <li>‚úÖ ƒê∆∞·ª£c t∆∞ v·∫•n ch·∫ø ƒë·ªô t·∫≠p luy·ªán mi·ªÖn ph√≠</li>
                        <li>‚úÖ S·ª≠ d·ª•ng ph√≤ng thay ƒë·ªì v√† t·ªß kh√≥a</li>
                        <li>‚úÖ Gi·∫£m gi√° 20% khi thu√™ PT ri√™ng</li>
                        <li>‚úÖ ∆Øu ƒë√£i ƒë·∫∑c bi·ªát v√†o sinh nh·∫≠t</li>
                    </ul>
                </div>
            `;
      }

      function renderTrainers() {
        const trainers = JSON.parse(
          localStorage.getItem("gym_trainers") || "[]"
        );
        const contentArea = document.getElementById("contentArea");

        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>üèãÔ∏è ƒê·ªôi ng≈© Hu·∫•n luy·ªán vi√™n</h2>
                </div>

                <div class="dashboard-grid">
                    ${trainers
                      .map(
                        (trainer) => `
                        <div class="stat-card">
                            <h3 style="color: #667eea; font-size: 18px; text-transform: none;">${trainer.name}</h3>
                            <p style="color: #666; margin: 10px 0;">üì± ${trainer.phone}</p>
                            <p style="color: #666; margin: 5px 0;">‚úâÔ∏è ${trainer.email}</p>
                            <p style="color: #666; margin: 5px 0;"><strong>Chuy√™n m√¥n:</strong> ${trainer.specialty}</p>
                            <p style="color: #666; margin: 5px 0;"><strong>Kinh nghi·ªám:</strong> ${trainer.experience}</p>
                            <p style="color: #666; margin: 5px 0;"><strong>Ch·ª©ng ch·ªâ:</strong> ${trainer.certifications}</p>
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;
      }

      function renderFacilities() {
        const contentArea = document.getElementById("contentArea");
        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>üè¢ Ph√≤ng t·∫≠p & Thi·∫øt b·ªã</h2>
                </div>

                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3 style="color: #667eea; font-size: 18px; text-transform: none;">Ph√≤ng t·∫≠p 1</h3>
                        <p style="color: #666; margin: 10px 0;">Di·ªán t√≠ch: 200m¬≤</p>
                        <p style="color: #666;">S·ª©c ch·ª©a: 30 ng∆∞·ªùi</p>
                        <p style="color: #666;">Thi·∫øt b·ªã: T·∫° ƒëa nƒÉng, M√°y ch·∫°y b·ªô</p>
                    </div>
                    <div class="stat-card">
                        <h3 style="color: #667eea; font-size: 18px; text-transform: none;">Ph√≤ng t·∫≠p 2</h3>
                        <p style="color: #666; margin: 10px 0;">Di·ªán t√≠ch: 150m¬≤</p>
                        <p style="color: #666;">S·ª©c ch·ª©a: 20 ng∆∞·ªùi</p>
                        <p style="color: #666;">Thi·∫øt b·ªã: Xe ƒë·∫°p, M√°y ch√®o</p>
                    </div>
                    <div class="stat-card">
                        <h3 style="color: #667eea; font-size: 18px; text-transform: none;">Khu Cardio</h3>
                        <p style="color: #666; margin: 10px 0;">Di·ªán t√≠ch: 100m¬≤</p>
                        <p style="color: #666;">10 m√°y ch·∫°y b·ªô</p>
                        <p style="color: #666;">8 xe ƒë·∫°p t·∫≠p</p>
                    </div>
                    <div class="stat-card">
                        <h3 style="color: #667eea; font-size: 18px; text-transform: none;">Ph√≤ng Yoga</h3>
                        <p style="color: #666; margin: 10px 0;">Di·ªán t√≠ch: 80m¬≤</p>
                        <p style="color: #666;">S·ª©c ch·ª©a: 25 ng∆∞·ªùi</p>
                        <p style="color: #666;">L·ªõp h·ªçc: 6:00, 18:00</p>
                    </div>
                </div>
            `;
      }

      // Member views
      function renderMySchedules() {
        renderSchedules(); // Reuse same view for now
      }

      function renderMyMembership() {
        const contentArea = document.getElementById("contentArea");
        contentArea.innerHTML = `
                <div class="section-header">
                    <h2>üí≥ Th·∫ª h·ªôi vi√™n c·ªßa t√¥i</h2>
                </div>
                <div class="member-card-preview" style="margin: 40px auto;">
                    <h3>TRUNG T√ÇM TH·ªÇ D·ª§C FITNESS</h3>
                    <div class="name">H·ªôi vi√™n Demo</div>
                    <div class="details">M√£ HV: MEM001</div>
                    <div class="details">G√≥i: 3 Th√°ng</div>
                    <div class="details">H·∫°n: 01/12/2024</div>
                    <div class="details">Tr·∫°ng th√°i: ƒêang ho·∫°t ƒë·ªông</div>
                </div>
                <div style="text-align: center;">
                    <button class="btn-primary" style="max-width: 300px;">Gia h·∫°n th·∫ª</button>
                </div>
            `;
      }

      function renderMyCheckins() {
        renderCheckins(); // Reuse same view
      }

      function renderMyInvoices() {
        renderInvoices(); // Reuse same view
      }

      // Utility Functions
      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("show");
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat("vi-VN", {
          style: "currency",
          currency: "VND",
        }).format(amount);
      }

      function formatDate(dateStr) {
        if (!dateStr) return "N/A";
        const date = new Date(dateStr);
        return date.toLocaleDateString("vi-VN");
      }

      function getPackageName(packageId) {
        const packages = {
          "1month": "1 Th√°ng",
          "3months": "3 Th√°ng",
          "6months": "6 Th√°ng",
          "1year": "1 NƒÉm",
        };
        return packages[packageId] || packageId;
      }

      function getPackagePrice(packageId) {
        const prices = {
          "1month": 500000,
          "3months": 1350000,
          "6months": 2500000,
          "1year": 4500000,
        };
        return prices[packageId] || 0;
      }

      function getStatusName(status) {
        const statuses = {
          active: "Ho·∫°t ƒë·ªông",
          expiring: "S·∫Øp h·∫øt h·∫°n",
          expired: "H·∫øt h·∫°n",
        };
        return statuses[status] || status;
      }

      function getFacilityName(facilityId) {
        const facilities = {
          room1: "Ph√≤ng t·∫≠p 1",
          room2: "Ph√≤ng t·∫≠p 2",
          cardio: "Khu Cardio",
          weights: "Khu T·∫° t·ª± do",
          yoga: "Ph√≤ng Yoga",
          main: "Khu v·ª±c ch√≠nh",
        };
        return facilities[facilityId] || facilityId;
      }

      function filterSchedules() {
        // Implementation for schedule filtering
        renderSchedules();
      }

      function switchReportTab(tab) {
        // Simple tab switching
        document
          .querySelectorAll(".tab")
          .forEach((t) => t.classList.remove("active"));
        event.target.classList.add("active");
      }

      // Initialize Application
      window.addEventListener("DOMContentLoaded", function () {
        initializeData();

        const savedUser = localStorage.getItem("currentUser");
        if (savedUser) {
          currentUser = JSON.parse(savedUser);
          document.getElementById("currentUserBadge").textContent =
            currentUser.name + " (" + getRoleName(currentUser.role) + ")";
          showMainApp();
        } else {
          showLogin();
        }

        // Check for expiring memberships
        const members = JSON.parse(localStorage.getItem("gym_members") || "[]");
        members.forEach((member) => {
          const endDate = new Date(member.endDate);
          const today = new Date();
          const daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));

          if (daysLeft < 0) {
            member.status = "expired";
          } else if (daysLeft <= 7) {
            member.status = "expiring";
          } else {
            member.status = "active";
          }
        });
        localStorage.setItem("gym_members", JSON.stringify(members));
      });

      // Close modals when clicking outside
      window.onclick = function (event) {
        if (event.target.classList.contains("modal")) {
          event.target.classList.remove("show");
        }
      };
    </script>
  </body>
</html>
